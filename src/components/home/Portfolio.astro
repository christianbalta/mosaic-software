---
import {Image} from 'astro:assets';

import agebetter from '../../assets/Agebetter-Mockup.png';
import bioshield from '../../assets/Bioshield-Mockup.png';
import kitaLuftibus from '../../assets/Kita-Luftibus-Mockup.png';
import fretz from '../../assets/Fretz-Gartenpflege-Mockup.png';
---

<section id="portfolio" class="relative py-16 lg:py-32">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-12">
      <h2 class="text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight text-desert-rock">
        Portfolio</h2>
      <p class="mt-4 md:text-lg max-w-3xl mx-auto">A selection of our recent work and product
        collaborations.</p>
    </div>
  </div>

  <!-- Stacking Cards Wrapper using the new card design -->
  <div class="relative">
    <div class="stack">
      <!-- Card 01 -->
      <article class="card portfolio-card">
        <div class="card-inner">
          <div class="card-copy">
            <div class="badge" aria-label="No strings attached">
              <span>Web-Applikation</span>
            </div>
            <h3 class="headline">
              <span>Agebetter</span>
            </h3>
            <p class="description">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ab
              aliquid aperiam architecto atque doloribus dolorum eaque excepturi fuga hic illum
              inventore, iusto, minus molestiae molestias nemo neque possimus quae quaerat quas quos
              reprehenderit, rerum sint unde veniam vero voluptate voluptates.</p>
            <a href="#" class="cta">Zur Website</a>
          </div>
          <div class="card-media">
            <Image
                src={agebetter}
                width={770}
                height={560}
                alt="Agebetter Website"/>
          </div>
        </div>
      </article>

      <!-- Card 02 -->
      <article class="card portfolio-card">
        <div class="card-inner">
          <div class="card-copy">
            <div class="badge" aria-label="Design sprints">
              <span>Online-Shop</span>
            </div>
            <h3 class="headline">
              <span>Swiss Bioshield</span>
            </h3>
            <p class="description">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aliquam
              animi aspernatur aut consectetur consequatur eveniet explicabo harum impedit itaque
              nihil nostrum, placeat quis quos ratione rem, temporibus totam veritatis, voluptates?
              Accusamus autem culpa explicabo harum nobis optio praesentium veritatis
              voluptatibus.</p>
            <a href="#" class="cta">Zur Website</a>
          </div>
          <div class="card-media">
            <Image
                src={bioshield}
                width={770}
                height={560}
                alt="Swiss Bioshield Website"/>
          </div>
        </div>
      </article>

      <!-- Card 03 -->
      <article class="card portfolio-card">
        <div class="card-inner">
          <div class="card-copy">
            <div class="badge" aria-label="Build and launch">
              <span>Website</span>
            </div>
            <h3 class="headline">
              <span>KiTa Luftibus</span>
            </h3>
            <p class="description">Lorem ipsum dolor sit amet, consectetur adipisicing elit. At hic
              officiis temporibus. Explicabo iure laudantium modi officiis recusandae sequi
              voluptate! Aliquam aliquid, animi distinctio dolor, ducimus fugit molestiae non nulla
              numquam pariatur placeat quam quasi quod repellendus voluptatibus? Incidunt,
              maxime.</p>
            <a href="#" class="cta">Zur Website</a>
          </div>
          <div class="card-media">
            <Image
                src={kitaLuftibus}
                width={770}
                height={560}
                alt="KiTa Luftibus Website"/>
          </div>
        </div>
      </article>

      <!-- Card 04 -->
      <article class="card portfolio-card bg-primary-light">
        <div class="card-inner">
          <div class="card-copy">
            <div class="badge" aria-label="Website">
              <span>Website</span>
            </div>
            <h3 class="headline">
              <span>Fretz Gartenpflege</span>
            </h3>
            <p class="description">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Beatae
              dicta facilis fuga id molestiae nesciunt optio reiciendis totam veritatis voluptatum!
              Consequatur cumque facere nam obcaecati officia voluptate. Ducimus eum hic neque
              numquam omnis recusandae repudiandae sunt tenetur velit voluptas! Culpa!</p>
            <a href="#" class="cta">Zur Website</a>
          </div>
          <div class="card-media">
            <Image
                src={fretz}
                width={770}
                height={560}
                alt="Fretz Gartenpflege GmbH Website"/>
          </div>
        </div>
      </article>
    </div>
  </div>
  <div aria-hidden="true" style="height: 0"></div>
</section>

<style>
  .portfolio-card {
    background: var(--color-porcelain-mist);
    border-radius: 24px;
    border: 1px solid rgba(0, 0, 0, .06);
    box-shadow: 0 10px 30px rgba(0, 0, 0, .06);
    overflow: hidden;
  }

  .portfolio-card .card-inner {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0;
  }

  .portfolio-card .card-copy {
    padding: 28px 24px 32px 24px;
    position: relative;
  }

  .portfolio-card .card-media img {
    width: 100%;
    height: 320px;
    object-fit: cover;
    display: block;
  }

  /* badge */
  .portfolio-card .badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: #fff;
    color: var(--color-dark-brown);
    border: 1px solid rgba(0, 0, 0, .08);
    padding: 10px 14px;
    border-radius: 999px;
    box-shadow: 0 6px 16px rgba(0, 0, 0, .06);
    margin-top: 48px;
    margin-bottom: 18px;
    font-size: 14px;
    font-weight: 600;
  }

  /* headline */
  .portfolio-card .headline {
    font-weight: 800;
    color: var(--color-dark-brown);
    letter-spacing: -0.02em;
    line-height: 1.1;
    font-size: clamp(28px, 4.8vw, 48px);
  }

  .portfolio-card .headline .accent {
    display: block;
    color: var(--color-desert-rock);
  }

  .portfolio-card .description {
    margin-top: 16px;
    color: var(--color-dark-brown);
    max-width: 60ch;
  }

  .portfolio-card .cta {
    display: inline-block;
    margin-top: 20px;
    padding: 12px 18px;
    background: var(--color-desert-rock);
    color: #fff;
    border-radius: 12px;
    font-weight: 700;
    text-decoration: none;
    transition: transform .2s ease, background .2s ease;
  }

  .portfolio-card .cta:hover {
    transform: translateY(-1px);
    background: var(--color-dark-brown);
  }

  .stack {
    position: relative;
  }

  .card {
    position: sticky;
    top: 80px;
    width: 80%;
    margin-left: auto;
    margin-right: auto;
    display: flex;
    align-items: stretch;
    z-index: 0;
    transition: transform 500ms ease, box-shadow 500ms ease, filter 500ms ease;
    border: 2px solid #fff3;
  }

  .card .card-inner {
    width: 100%;
  }

  .card {
    margin-bottom: calc(28vh - 80px);
  }

  .card + .card {
    margin-top: -14vh;
  }

  .stack .card:last-of-type {
    margin-bottom: 0;
  }

  .card.is-behind {
    transform: translateY(-6px) scale(.97);
    filter: saturate(.9) brightness(.98);
  }

  .card.is-front {
    box-shadow: 0 30px 90px rgba(0, 0, 0, .28);
  }

  /* Mobile adjustments: disable sticky stacking to prevent overlap */
  @media (max-width: 809px) {
    .stack {
      /* make sure container doesn't interfere */
      position: static;
    }
    .card {
      position: static;
      top: auto;
      width: 100%;
      margin-left: auto;
      margin-right: auto;
      margin-bottom: 24px; /* regular spacing between cards */
      z-index: auto;
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: 0 10px 30px rgba(0,0,0,.06);
      transform: none !important;
      filter: none !important;
    }
    .card + .card {
      margin-top: 0; /* remove overlap pull-up */
    }
    .portfolio-card .card-media img {
      height: 320px; /* keep image visible on small screens */
      border-radius: 0; /* avoid odd rounding when stacked */
    }
  }

  @media (min-width: 1024px) {
    .portfolio-card .card-inner {
      grid-template-columns: 1.1fr 1.2fr;
      align-items: stretch;
    }

    .portfolio-card .card-copy {
      padding: 56px 56px 64px 56px;
    }

    .portfolio-card .card-media img {
      height: 560px;
      border-top-left-radius: 24px;
      border-bottom-left-radius: 24px;
    }

    .card {
      top: 96px;
    }

    .card {
      margin-bottom: calc(26vh - 96px);
    }

    .card + .card {
      margin-top: -16vh;
    }

    .stack .card:last-of-type {
      margin-bottom: 0;
    }
  }
</style>

<script>
  // Lightweight IntersectionObserver to add depth while scrolling
  const cards = Array.from(document.querySelectorAll('.stack .card'));
  if (cards.length) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        const el = entry.target;
        if (entry.isIntersecting && entry.intersectionRatio > 0.55) {
          cards.forEach(c => c.classList.remove('is-front'));
          el.classList.add('is-front');
        }
        const index = cards.indexOf(el);
        cards.forEach((c, i) => {
          c.classList.toggle('is-behind', i < index);
        });
      });
    }, {threshold: [0.55]});
    cards.forEach(c => observer.observe(c));
  }
</script>
