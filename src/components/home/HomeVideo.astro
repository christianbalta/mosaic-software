---
import { MuxPlayer } from '@mux/mux-player-astro';

const playbackId = "dSr8i00jXSrtrsWkOYi301PHczBxxRay5Z31F9cXjZtGw";
const videoTitle = "Mosaic Software Showreel";
---

<section class="w-full flex justify-center py-12 md:py-20 overflow-hidden bg-soft-sandstone/20">
  <div class="video-scale-container w-full max-w-[1400px] px-4 md:px-8 mx-auto transition-transform duration-100 ease-out origin-center will-change-transform">
    <div class="relative w-full aspect-video rounded-2xl md:rounded-3xl overflow-hidden shadow-2xl">
      <MuxPlayer
          theme="minimal"
          playbackId={playbackId}
          metadata={{
            video_title: videoTitle,
          }}
          primaryColor="#fff"
          secondaryColor="#a48d78"
          accentColor="#cbb9a4"
          defaultShowRemainingTime={true}
      />
    </div>
  </div>
</section>

<script>
  const initVideoScroll = () => {
    const container = document.querySelector('.video-scale-container') as HTMLElement;
    
    if (!container) return;

    const handleScroll = () => {
      const rect = container.getBoundingClientRect();
      const windowHeight = window.innerHeight;
      
      // Calculate distance from center of viewport
      const centerViewport = windowHeight / 2;
      const centerElement = rect.top + (rect.height / 2);
      const distanceFromCenter = Math.abs(centerViewport - centerElement);
      
      // Max distance where scaling applies (e.g., 60% of viewport height)
      const maxDistance = windowHeight * 0.6; 
      
      let scale = 1;
      if (distanceFromCenter < maxDistance) {
        // Map distance to scale range [0.85, 1.0]
        const ratio = 1 - (distanceFromCenter / maxDistance);
        scale = 0.85 + (0.15 * ratio); 
      } else {
        scale = 0.85;
      }
      
      // Clamp scale
      scale = Math.min(Math.max(scale, 0.85), 1);
      
      container.style.transform = `scale(${scale})`;
    };

    // Initial check
    window.requestAnimationFrame(handleScroll);

    // Add listener
    window.addEventListener('scroll', () => {
      window.requestAnimationFrame(handleScroll);
    });
  };

  // Run on load
  initVideoScroll();
  
  // Run on view transitions navigation if enabled
  document.addEventListener('astro:page-load', initVideoScroll);
</script>
