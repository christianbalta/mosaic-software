---
import type {FAQItem} from "../../../types/faq.ts";

const {title = 'Häufige Fragen', items = []} = Astro.props as {
  title: string;
  items: FAQItem[];
};

const description = 'Klarheit schafft Vertrauen. Hier findest du Antworten auf die wichtigsten Fragen zur Zusammenarbeit.';
---

<section id="faq" class="py-12 lg:py-20">
  <div class="grid grid-cols-1 lg:grid-cols-12 gap-12 lg:gap-20 items-start">

    <!-- Left Column: Header & Contact -->
    <div class="lg:col-span-4 space-y-10 lg:sticky lg:top-32">
      <div class="space-y-4">
        <span class="text-desert-rock font-semibold uppercase tracking-wider text-sm">Support</span>
        <h2 class="text-3xl sm:text-4xl lg:text-5xl text-dark-brown leading-tight">{title}</h2>
        <p class="text-lg text-dark-brown/80 leading-relaxed">
          {description}
        </p>
      </div>
      <div
          class="rounded-[2rem] p-8 bg-dark-brown text-feather-white relative overflow-hidden group">
        <div
            class="absolute top-0 right-0 w-32 h-32 bg-desert-rock/20 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 group-hover:bg-desert-rock/30 transition-colors duration-700"></div>
        <div
            class="absolute bottom-0 left-0 w-24 h-24 bg-black-olive/30 rounded-full blur-2xl translate-y-1/2 -translate-x-1/2"></div>

        <div class="relative z-10">
          <div
              class="w-12 h-12 rounded-2xl bg-white/10 backdrop-blur-sm flex items-center justify-center text-desert-rock mb-6 border border-white/10">
            <i class="fa-solid fa-comments text-xl"></i>
          </div>

          <h3 class="text-xl font-bold mb-2">Frage nicht dabei?</h3>
          <p class="text-feather-white/80 text-sm mb-8 leading-relaxed">
            Kein Problem. Schreibe uns direkt oder buche ein kurzes Kennenlerngespräch.
          </p>

          <a href="mailto:contact@mosaic-software.ch"
             class="inline-flex w-full items-center justify-center gap-3 px-6 py-3.5 rounded-xl bg-feather-white text-dark-brown font-bold hover:bg-desert-rock hover:text-feather-white transition-all duration-300 group-hover:shadow-lg group-hover:-translate-y-0.5">
            <span>Kontakt aufnehmen</span>
            <i class="fa-solid fa-arrow-right text-sm"></i>
          </a>
        </div>
      </div>
    </div>

    <!-- Accordion List -->
    <div class="lg:col-span-8">
      <div class="divide-y divide-soft-sandstone/30 border-t border-soft-sandstone/30">
        {items.map((item, index) => (
            <div class="faq-item group">
              <button
                  class="faq-button w-full py-8 flex items-start text-left focus:outline-none group-hover:bg-porcelain-mist/30 transition-colors rounded-lg px-2 -mx-2"
                  aria-expanded="false"
              >
                <span class="hidden sm:block text-desert-rock/60 font-mono text-sm pt-1.5 mr-6 w-8">
                {(index + 1).toString().padStart(2, '0')}
              </span>

                <div class="flex-1 pr-6">
                <span
                    class="text-xl sm:text-2xl font-semibold text-dark-brown group-[.active]:text-desert-rock transition-colors duration-300">
                  {item.question}
                </span>
                </div>

                <div
                    class="relative w-8 h-8 flex-shrink-0 flex items-center justify-center rounded-full border border-dark-brown/20 text-dark-brown group-[.active]:border-desert-rock group-[.active]:bg-desert-rock group-[.active]:text-white transition-all duration-300">
                  <i class="fa-solid fa-chevron-down text-sm transition-transform duration-300 group-[.active]:rotate-180"></i>
                </div>
              </button>

              <div
                  class="faq-content grid grid-rows-[0fr] transition-[grid-template-rows] duration-500 ease-out">
                <div class="overflow-hidden">
                  <div class="pb-8 sm:pl-14 text-dark-brown/80 text-lg leading-relaxed max-w-prose">
                    {item.answer}
                  </div>
                </div>
              </div>
            </div>
        ))}
      </div>
    </div>

  </div>
</section>

<script>
  function setupFAQ() {
    const faqItems = document.querySelectorAll('.faq-item');

    faqItems.forEach((item) => {
      const button = item.querySelector('.faq-button');
      // Prevent multiple bindings if setupFAQ runs more than once
      if (!button) return;
      if (button.dataset && button.dataset.bound === '1') return;
      if (button.dataset) button.dataset.bound = '1';

      button.addEventListener('click', () => {
        const isActive = item.classList.contains('active');

        // Close others when opening one
        faqItems.forEach(otherItem => {
          if (otherItem !== item) {
            otherItem.classList.remove('active');
            otherItem.querySelector('.faq-button')?.setAttribute('aria-expanded', 'false');
          }
        });

        item.classList.toggle('active');
        button.setAttribute('aria-expanded', (!isActive).toString());
      });
    });
  }

  // Run on load
  setupFAQ();

  // Re-run on Astro view transitions
  document.addEventListener('astro:page-load', setupFAQ);
</script>

<style>
  /* Utility for the grid animation */
  .faq-item.active .faq-content {
    grid-template-rows: 1fr;
  }
</style>